--[[
    Universal Remote Spy
    Hooks into the global firesignal function to log all client-to-server
    remote event calls. This allows us to see the exact arguments used
    by the game's own scripts.

    -- HOW TO USE --
    1. Execute this script. The GUI will appear.
    2. Go play the game and perform an action that gives you an item
       (buy from shop, pickup, quest reward, etc.).
    3. Look at the spy's output. It will show you the index of the remote
       that was fired and the precise structure of the arguments table.
    4. Use that information to build the correct item spawner call.
]]

-- A simple GUI to display the logs
local spyGui = Instance.new("ScreenGui")
local logFrame = Instance.new("ScrollingFrame")
local uiListLayout = Instance.new("UIListLayout")
spyGui.Name = "RemoteSpyGUI"
spyGui.ResetOnSpawn = false
logFrame.Name = "LogFrame"
logFrame.Size = UDim2.new(0.4, 0, 0.5, 0)
logFrame.Position = UDim2.new(0.6, -10, 0, 10)
logFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
logFrame.BackgroundTransparency = 0.3
logFrame.BorderColor3 = Color3.fromRGB(120, 120, 120)
uiListLayout.Parent = logFrame
logFrame.Parent = spyGui
spyGui.Parent = game:GetService("CoreGui")

-- Function to pretty-print tables for easy reading
local function formatTable(tbl, indent)
    indent = indent or 0
    local str = "{\n"
    for k, v in pairs(tbl) do
        local keyStr = (typeof(k) == "string") and "[\"" .. k .. "\"]" or "[" .. tostring(k) .. "]"
        str = str .. string.rep("  ", indent + 1) .. keyStr .. " = "
        if typeof(v) == "table" then
            str = str .. formatTable(v, indent + 1) .. ",\n"
        elseif typeof(v) == "string" then
            str = str .. "\"" .. tostring(v) .. "\",\n"
        else
            str = str .. tostring(v) .. ",\n"
        end
    end
    str = str .. string.rep("  ", indent) .. "}"
    return str
end

-- The core spy logic
if not getconnections then
    warn("Spy Error: getconnections is required for this spy to function.")
    return
end

local eventsFolder = game:GetService("ReplicatedStorage"):WaitForChild("Communication"):WaitForChild("Events")
local allRemotes = eventsFolder:GetChildren()

print("Remote Spy is active. Perform an action in-game that involves a remote event.")

for i, remote in ipairs(allRemotes) do
    if remote:IsA("RemoteEvent") and remote.Name == "" then
        for _, connection in ipairs(getconnections(remote.OnClientEvent)) do
            connection:Disable() -- Temporarily disable original connections
        end

        remote.OnClientEvent:Connect(function(...)
            local args = {...}
            
            -- Log to console
            print("--- Remote Fired ---")
            print("Remote Index: #" .. i)
            print("Arguments Table:", formatTable(args))
            print("--------------------")

            -- Log to GUI
            local logLabel = Instance.new("TextLabel")
            logLabel.Text = "Index: #" .. i .. " | Args: " .. formatTable(args)
            logLabel.TextColor3 = Color3.new(0, 1, 0)
            logLabel.TextWrapped = true
            logLabel.TextXAlignment = Enum.TextXAlignment.Left
            logLabel.Size = UDim2.new(1, -10, 0, 80)
            logLabel.BackgroundTransparency = 1
            logLabel.Font = Enum.Font.Code
            logLabel.Parent = logFrame

            -- Re-fire the event so the game doesn't break
            firesignal(remote.OnClientEvent, ...)
        end)
    end
end